\section{MariaDB}\label{sect:maria-db}

\subsection*{DBMS}

DBMS는 데이터베이스 관리 시스템(Database Management System)의 줄임말로, 데이터베이스를 사용하기 편리하도록 만들어진 프로그램이다. DBMS는 데이터를 다루는 작업, 데이터베이스 생성, 사용자 생성, 사용자 권한 설정 등 데이터베이스 전반을 관리하고 호스팅하는 역할을 한다.

RDB형 DBMS에는 대표적으로 MySQL, Oracle, MSSQL, PostgreSQL 등이 있고, 이 중 MySQL은 오픈 소스 소프트웨어라는 점, 표준에 가까운 SQL을 사용한다는 점 등으로 인해 RDB형 DBMS 중 가장 높은 점유율을 자랑해왔다. 그러나 MySQL이 오픈 소스에 적대적인 Oracle에 인수되어 라이선스 상태가 불안정해지자 MySQL의 개발팀이 MySQL을 기반으로 MariaDB라는 DBMS를 개발하였다. MariaDB는 MySQL과 완벽히 호환되며 최근에는 MySQL의 상위호환으로 거듭나 MariaDB의 사용률이 급증하는 추세이다. 따라서 본 교재에서는 가장 최근 버전의 MariaDB\footnote{2021년 9월 기준 10.6.4}를 이용하여 DB와 관련된 실습을 진행한다.

\subsection*{Installation (Windows)}

MariaDB 홈페이지(https://downloads.mariadb.org/)에서 자신의 OS 버전과 맞는 msi 패키지를 다운로드하여 실행한다.

\figures{fig:mariadb-install-windows}{Installation of MariaDB server on Windows}{
    \subfig{fig:mariadb-install-windows-location}{Copy Install Directory}
        {images/database-designing/mariadb-install-windows-location.png}{.31}
    \subfig{fig:mariadb-install-windows-password}{Set Password and Charset}
        {images/database-designing/mariadb-install-windows-password.png}{.31}
    \subfig{fig:mariadb-install-windows-port}{Set TCP Port}
        {images/database-designing/mariadb-install-windows-port.png}{.31}
}

먼저 \figref{fig:mariadb-install-windows-location}\과 같이 DBMS의 설치 경로\footnote{10.6 버전의 경우 C:\textbackslash{}Program Files\textbackslash{}MariaDB 10.6}를 미리 파악해둔다. 이후 \figref{fig:mariadb-install-windows-password}\와 같이 root 계정(관리자 계정)의 비밀번호를 설정하고 문자 집합을 UTF8로 체크하여 한글 및 기타 특수문자를 사용할 수 있도록 설정한다. root 계정은 DBMS 내의 모든 DB와 데이터를 다룰 수 있는 권한을 가지고 있고, root 비밀번호를 잊어버리면 DBMS를 재설치하는 것 외에는 접속 권한을 가질 수 없으므로 신중하게 정하고 기억해야 한다. 

마지막으로 \figref{fig:mariadb-install-windows-port}\와 같이 MariaDB에 접속하기 위한 port 번호를 TCP port란에 설정한다. MariaDB는 기본적으로 3306번 port를 사용하며, 여타 이유로 3306 port가 선점되어 있다면 3307번 등 다른 port로 변경한다.\footnote{3306번은 기본 port이므로 보안을 위해 일부러 다른 port로 바꾸기도 한다.}

\figures{fig:mariadb-env-variable}{Setting Environment Variable}{
    \subfig{fig:env-var-1}{Step 1}
        {images/database-designing/env-var-1.png}{.2940}
    \subfig{fig:env-var-2}{Step 2}
        {images/database-designing/env-var-2.png}{.2926}
    \subfig{fig:env-var-3}{Step 3}
        {images/database-designing/env-var-3.png}{.3434}
}

이제 윈도우의 shell인 cmd에서 MariaDB에 접속할 수 있도록 환경 변수를 설정한다. 먼저 윈도우 탐색기를 열고, \figref{fig:mariadb-install-windows-location}에서 파악한 설치 경로를 연다. 설치 폴더 아래의 bin 폴더에 mysql.exe 파일이 있는 것을 확인한 뒤 bin 폴더의 전체 경로\footnote{10.6 버전의 경우 C:\textbackslash{}Program Files\textbackslash{}MariaDB 10.6\textbackslash{}bin}를 복사한다. 이후 윈도우 검색을 이용해 [시스템 환경 변수 편집]을 실행하고, \figref{fig:mariadb-env-variable}\과 같이 환경 변수 편집 창에 진입하고, [새로 만들기] 버튼을 클릭하여 앞에서 복사한 bin 폴더의 전체 경로를 붙여넣어 추가한다.

\begin{shellenv}{shell:mariadb-check-install}{Checking MariaDB Installation}\begin{verbatim}
$ mysql --version
\end{verbatim}
\end{shellenv}

이제 cmd 창을 열고, \shellref{shell:mariadb-check-install}\와 같이 MariaDB가 제대로 설치되었는지 확인한다.

\subsection*{Installation (macOS)}

\begin{shellenv}{shell:install-homebrew}{Installing Homebrew}\begin{verbatim}
$ /bin/bash -c \
    "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
$ brew update
\end{verbatim}
\end{shellenv}

macOS에서는 먼저 \shellref{shell:install-homebrew}\를 따라 패키지 관리자인 Homebrew를 설치하고, 설치되었는지 확인한다.

\begin{shellenv}{shell:mariadb-installation-macos}{Installing MariaDB (macOS)}\begin{verbatim}
$ brew info mariadb
$ brew install mariadb
$ brew services start mariadb
\end{verbatim}
\end{shellenv}

Homebrew를 이용해 \shellref{shell:mariadb-installation-macos}\를 참고하여 MariaDB를 설치한 뒤 MariaDB를 실행한다. 자세한 설치 방법은 MariaDB에서 제공하는 설치 가이드\footnote{https://mariadb.com/resources/blog/installing-mariadb-10-1-16-on-mac-os-x-with-homebrew/}를 참고하여 설치한다. 설치가 완료되면 \shellref{shell:mariadb-check-install}\와 같이 확인해본다.

\subsection*{Installation (Ubuntu)}

\begin{shellenv}{shell:mariadb-installation-ubuntu}{Installing MariaDB (Ubuntu)\footnote{MariaDB 10.6 기준}}\begin{verbatim}
$ sudo apt-get install software-properties-common
$ sudo apt-key adv --recv-keys --keyserver \
    hkp://keyserver.ubuntu.com:80 0xF1656F24C74CD1D8
$ sudo add-apt-repository 'deb [arch=amd64,arm64,ppc64el] \
    http://mariadb.mirror.liquidtelecom.com/repo/10.6/ubuntu bionic main'
$ sudo apt install mariadb-server
\end{verbatim}
\end{shellenv}

대표적인 Linux 계열의 OS인 Ubuntu에서는 먼저 \shellref{shell:mariadb-installation-ubuntu}\와 같이 MariaDB 웹 사이트에서 repository를 다운로드하고, 이를 apt를 이용하여 설치한다.

\begin{shellenv}{shell:mariadb-config-ubuntu}{Configuration of MariaDB (Ubuntu)}\begin{verbatim}
$ sudo mysql_secure_installation
Enter current password for root (enter for none): // your root password here
OK, successfully used password, moving on...
Switch to unix_socket authentication [Y/n] n
Change the root password? [Y/n] n
Remove anonymous users? [Y/n] y
Disallow root login remotely? [Y/n] n
Remove test database and access to it? [Y/n] y
Reload privilege tables now? [Y/n] y
Thanks for using MariaDB!
\end{verbatim}
\end{shellenv}

이후 \coderef{shell:mariadb-config-ubuntu}\와 같이 MariaDB를 설정하고, \shellref{shell:mariadb-check-install}\와 같이 확인해본다.

\subsection*{Accessing MariaDB Server}

\begin{shellenv}{shell:mariadb-login}{Basic Command Logging In MariaDB}\begin{verbatim}
$ mysql –u<username> -p<password>
\end{verbatim}
\end{shellenv}

이제 shell을 통해 MariaDB에 접속할 수 있다. \shellref{shell:mariadb-login}\은 MariaDB에 로그인하는 가장 기본적인 명령어로, 현재는 root 계정만 존재하므로 root 계정으로 로그인한다. \cd{<username>} 부분을 root으로, \cd{<password>} 부분을 root 계정의 비밀번호로 바꾸어 명령어를 작성한다.

\begin{shellenv}{shell:mariadb-sudo-login}{Accessing root User using sudo}\begin{verbatim}
$ sudo mysql
\end{verbatim}
\end{shellenv}

Unix 계열의 OS에서는 \shellref{shell:mariadb-login}와 같이 root 계정에 접속하지 못하는 경우가 있는데 \shellref{shell:mariadb-sudo-login}\과 같이 sudo 권한으로 실행하면 자동으로 root 계정으로 접속된다.

\begin{shellenv}{shell:query-db-list}{Querying List of Databases}\begin{verbatim}
MariaDB [(none)]> SHOW DATABASES;
\end{verbatim}
\end{shellenv}

\shellref{shell:query-db-list}\와 같이 SQL을 사용하여 현재 DBMS에 있는 데이터베이스의 목록을 조회할 수 있다. 커서 부분의 대괄호(\cd{[]}) 내부에는 현재 사용자가 작업 중인 데이터베이스의 이름이 표시되며, 현재는 작업 중인 데이터베이스가 없으므로 \cd{(none)}으로 표시된다.

\begin{shellenv}{shell:create-and-use-db}{Creating and Using Database}\begin{verbatim}
MariaDB [(none)]> CREATE DATABASE kweb_db;
MariaDB [(none)]> USE kweb_db;
MariaDB [kweb_db]>
\end{verbatim}
\end{shellenv}

\shellref{shell:create-and-use-db}\와 같이 \cd{CREATE DATABASE} 키워드를 이용하여 \cd{kweb\_db}라는 데이터베이스를 생성할 수 있고, \cd{USE} 키워드를 이용하여 작업 중인 데이터베이스를 \cd{kweb\_db}로 바꿀 수 있다.

이렇게 SQL을 이용하여 데이터베이스의 목록을 조회하고, 생성해 보았다. 본 교재에서는 이후 DB shell을 표시할 때 커서 부분에서 DBMS와 DB의 이름은 생략한다.
