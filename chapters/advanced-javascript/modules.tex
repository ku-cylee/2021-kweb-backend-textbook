\section{Modules}\label{sect:modules}

\subsection*{Necessity of Modules}

모듈(module)이란 외부의 영향을 받지 않는 독립적이고, 재사용이 가능한 코드의 묶음이다. 대체로 하나의 모듈에는 유사한 목적을 가진 상수, 메서드, 하위 모듈 등이 모여 있다. 예를 들어, C에는 strlen, strcat, strcpy 등 문자열을 다루는 함수들을 모아둔 string.h라는 헤더가 있고, Python에는 listdir, mkdir, rename 등 운영체제와 관련된 메서드를 모아둔 os라는 모듈이 있다. 마찬가지로 Node.js에도 파일 시스템을 다루기 위한 모듈, HTTP 요청을 보내고 응답을 받기 위한 모듈 등 특정 목적을 가진 코드들의 집합인 모듈들이 존재한다.

앞서 언급한 파일 시스템을 다루기 위한 모듈, HTTP 요청을 보내고 응답을 받기 위한 모듈 등은 Node.js에서는 기본적으로 제공하는 내장 모듈이다. 내장 모듈에 대한 API 문서는 Node.js 홈페이지\footnote{https://nodejs.org/dist/latest-v12.x/docs/api/}에서 확인할 수 있다. 개발자는 내장 모듈 이외에도 자신만의 모듈을 제작하여, 자신의 코드를 목적에 맞게 분류하여 프로젝트를 구조화하거나, 자신이 원하는 기능을 모아둔 모듈을 제작할 수 있다.

Node.js를 이용하여 개발하면서, 개발자는 이러한 모듈을 다양하게 이용할 수 있다. 내장 모듈이나 자신이 제작한 모듈을 사용하거나, 패키지 매니저를 이용하여 완성도 있고 유용한 외장 모듈을 다운로드받아 사용할 수 있다. npm(node package manager)은 Node.js의 가장 대표적인 패키지 매니저로, 앞서 \sectref{sect:installing-and-running-node-js}에서 Node.js를 설치하는 과정에서 같이 설치한 바 있다. 최근에는 npm 이외에도 yarn 등의 패키지 매니저를 사용하기도 한다.

모듈을 전혀 사용하지 않고 완성도 있는 프로그램을 작성하는 것은 거의 불가능에 가깝다. 애플리케이션의 모든 기능을 개발자가 직접 하나하나 구현할 수는 있으나, 효율적인 개발이 불가능하고 코드가 매우 난잡해지는 등 가독성과 유지보수 측면에서 매우 나쁜 방법이다. 이번 장에서는 모듈을 사용하는 방법과 제작하는 방법에 대해 스터디할 것이다.

\subsection*{모듈의 설치}

외장 모듈은 npm을 이용하여 설치할 수 있다. 기본적으로, 모듈은 프로젝트마다 따로 설치하는 것이 원칙이다. 물론 전역(global)적으로 설치할 수는 있지만, 코드에 직접 사용되는 모듈은 dependency 측면에서 프로젝트별로 설치하는 것이 원칙이다.

\coderef{code:external-module-install}은 hexo라는 모듈을 프로젝트에 설치하는 방법이다.

\begin{codeenv}{code:external-module-install}{Installing External Module}\begin{verbatim}
$ npm install hexo
\end{verbatim}
\end{codeenv}

\subsection*{모듈의 생성}

모듈은 하나의 파일이 하나의 모듈로 간주된다. \cd{module.exports}에 다른 파일에서 사용하고자 하는 상수, 함수, 객체 등의 값을 할당해주면, 모듈의 기능을 수행할 수 있다. \coderef{code:creating-module}은 모듈을 생성하는 예제이다.

\begin{codeenv}{code:creating-module}{Creating Module - sayHello.js}\begin{verbatim}
const format = (language, hello) => {
    console.log(`Hello is "${hello}" in ${language}.`);
};

export const english = () => {
    return format('english', 'Hello');
};

export const spanish = () => {
    return format('spanish', 'Hola');
};

export const french = () => {
    return format('french', 'Bonjour');
};

export const german = () => {
    return format('german', 'Guten Tag');
};
\end{verbatim}
\end{codeenv}

\subsection*{모듈의 사용}

모듈은 \cd{require} 함수를 사용하여 import할 수 있다. \cd{require} 함수는 모듈의 경로를 인자로 받는데, 내장 모듈이나 외장 모듈은 이름만 작성하면 되고, custom 모듈은 모듈을 사용하고자 하는 파일과의 상대 경로를 작성하면 됩니다.

먼저, \coderef{code:import-internal-module}\은 내장 모듈인 \cd{path}를 import하여 \cd{path}라는 상수에 할당하고, 이를 사용하는 코드이다.

\begin{codeenv}{code:import-internal-module}{Import Internal Module}\begin{verbatim}
const path = require('path');

const myFile = '/home/ubuntu/kuniv/kweb/example.js';
const dirname = path.dirname(myFile);
const basename = path.basename(myFile);
const extname = path.extname(myFile);

console.log(`path.dirname = ${dirname}`);
console.log(`path.basename = ${basename}`);
console.log(`path.extname = ${extname}`);
\end{verbatim}
\end{codeenv}

\coderef{code:import-custom-module} 앞서 작성한 sayHello 모듈을 import하고 사용하는 코드이다.

\begin{codeenv}{code:import-custom-module}{Import Custom Module}\begin{verbatim}
const sayHello = require('./sayHello');

sayHello.english();
sayHello.spanish();
sayHello.french();
sayHello.german();
\end{verbatim}
\end{codeenv}

\cd{require} 함수의 인자로 \cd{sayHello} 모듈 파일의 상대 경로가 들어간 것을 볼 수 있다.
